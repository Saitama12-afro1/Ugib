{% extends "crud/base.html" %}

{% load render_table from django_tables2 %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load static %}
{%block script%}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://unpkg.com/htmx.org@1.8.0" integrity="sha384-cZuAZ+ZbwkNRnrKi05G/fjBX+azI9DNOkNYysZ0I/X5ZFgsmMiBXgDZof30F5ofc" crossorigin="anonymous"></script>
<link rel="stylesheet" href="{% static 'css/main.css' %}">
<link rel="stylesheet" href="{% static 'css/validation.css' %}">
<script src="{% static 'js/main.js' %}"></script>  
<script src="{% static 'js/validators.js' %}"></script>  
<script src="{% static 'js/jquery.js' %}"></script>  
{%endblock%}

{% block body %}
    <div class = "boss_div">
    <div class = "head">
      {% if user.is_active %}
      {% if common_user %}   
        <a href = "{% url "crud:profile"%}"> Профиль</a>
      {% endif %} 
        <a href = "{% url "crud:logout"%}"> Выйти</a>
        {% if user.username == "vahrushev@tsnigri.ru" or user.username == "uvarova@tsnigri.ru" %}
        <a href = "{% url "crud:history"%}"> История</a>
        {% endif %}

        <br>
      {% endif %}
        
    {# Search form #}
    {% if user.is_active %}
    <form hx-get="/" 
          hx-target="div.table-container" 
          hx-swap="outerHTML" 
          hx-indicator=".progress" 
          class="form-inline">
        {% crispy filter.form %}
    </form>
    {% endif %}
</div>
<div class = "modal_form">
    {% if user.is_active == False %} 
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
        Войти
    </button>
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Вход</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
              <div class="form-group">
              <form  method = "POST">
                  {% csrf_token %}
                  {{form|crispy}}
                  <button type = "submit" name = "login"> Войти</input>
                </form>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
</div> 

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#RegModalCenter">
  Зарегистрироваться 
</button>
<div class="modal fade" id="RegModalCenter" tabindex="-1" role="dialog" aria-labelledby="RegModalCenterTitle" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered" role="document">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLongTitle">Вход</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <div class="form-group">
        <form  method = "POST">
            {% csrf_token %}
            {{register_form|crispy}}
            <button type = "submit" name = "register"> Зарегистрироваться </input>
          </form>
        </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
    </div>
  </div>
</div>
</div>
</div> 
    {% endif %}

<div class = "create_div">
{% if user.is_active%}
{% if common_user == False %}
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalLong" id = "create_button">
    Создать
</button>
{% endif %}
{% endif %}
<div class="modal fade" id="ModalLong" tabindex="-1" role="dialog" aria-labelledby="ModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl modal-custom " id = "custom_modal" role="document">
      <div class="modal-content modal-content-custom" >
        <div class="modal-header">
          <select>
            <option>01FOND</option>
          </select>
          <select id = "select_sub" onClick = "dinamic_form(event)" >
            <option>01TSNIGRI</option>
            <option>02RFGF</option>
            <option>03TGF</option>
            <option>04OTHER_ORG</option>
          </select>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <form  method = "POST" id = "create_form">
                {% csrf_token %}
                <div class = "col">
                  <div class = "col" id = "valid_div">
        
				          </div>
                </div>
                <button type="button" id = "my_but" class="btn btn-secondary my_but" data-dismiss="modal"  onClick = "createPost(event)"  form = "{{record.oid}}"> Создать </button>
              </form>
        </div>
        <div class="modal-footer">
          <button type="button"  class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</div>

</div>

<div class="modal fade" id="updModal" tabindex="-1" role="dialog" aria-labelledby="updModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <textarea class = "modal_area" id = "modal_area">  </textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"  id = "close_btn">Close</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" onClick = "upd_post(event)" id = "upd_btn">Изменить</button>
      </div>
    </div>
  </div>
</div>
    {# Progress indicator #}
    <div class="progress">
        <div class="indeterminate"></div>
    </div>

    {# The actual table #}
    <div class = "obs_table">
      <input hidden value = '{{common_user}}'  id = 'info_user'>
    {% render_table table %}
	</div>
{% endblock %}